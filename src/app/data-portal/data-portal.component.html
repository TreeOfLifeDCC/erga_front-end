<br>
<div class="container">
  <div class="item0">
  </div>
  <div class="item1">
    <mat-card class="main-card">
      <mat-card-title class="card-title">Data status</mat-card-title>
      <mat-card-actions fxFlexAlign="center" style="width: 100%">
        <mat-list role="list" style="width: 100%">
          <mat-list-item role="listitem" *ngIf="getStatusCount(aggregations?.biosamples.buckets)"
                         [style]="checkStyle('BioSamples - Submitted')"
                         (click)="onFilterClick('BioSamples - Submitted')" style="cursor: pointer">
            <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
              <div>
                <h4 matLine class="vertical-center">BioSamples - Submitted</h4>
              </div>
              <div style="margin-left: auto">
                <mat-chip-set>
                  <mat-chip style="font-size: 10px">
                    {{getStatusCount(aggregations?.biosamples.buckets)}}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>
          </mat-list-item>
          <mat-list-item role="listitem" *ngIf="getStatusCount(aggregations?.raw_data.buckets)"
                         [style]="checkStyle('Raw Data - Submitted')"
                         (click)="onFilterClick('Raw Data - Submitted')" style="cursor: pointer">
            <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
              <div>
                <h4 matLine class="vertical-center">Raw Data - Submitted</h4>
              </div>
              <div style="margin-left: auto">
                <mat-chip-set>
                  <mat-chip style="font-size: 10px">
                    {{getStatusCount(aggregations?.raw_data.buckets)}}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>

          </mat-list-item>
          <mat-list-item role="listitem" *ngIf="getStatusCount(aggregations?.assemblies_status.buckets)"
                         [style]="checkStyle('Assemblies - Submitted')"
                         (click)="onFilterClick('Assemblies - Submitted')" style="cursor: pointer">
            <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
              <div>
                <h4 matLine class="vertical-center">Assemblies - Submitted</h4>
              </div>
              <div style="margin-left: auto">
                <mat-chip-set>
                  <mat-chip style="font-size: 10px">
                    {{getStatusCount(aggregations?.assemblies_status.buckets)}}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>
          </mat-list-item>
          <mat-list-item role="listitem" *ngIf="getStatusCount(aggregations?.annotation_complete.buckets)"
                         [style]="checkStyle('Annotation Complete - Done')"
                         (click)="onFilterClick('Annotation Complete - Done')" style="cursor: pointer">
            <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
              <div>
                <h4 matLine class="vertical-center">Annotation Complete - Done</h4>
              </div>
              <div style="margin-left: auto">
                <mat-chip-set>
                  <mat-chip style="font-size: 10px">
                    {{getStatusCount(aggregations?.annotation_complete.buckets)}}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card-actions>
    </mat-card>
    <br>
    <mat-card class="main-card">
      <mat-card-title class="card-title">Symbionts</mat-card-title>
      <mat-card-actions fxFlexAlign="center" style="width: 100%">
        <mat-list role="list" style="width: 100%">
          <ng-container *ngFor="let filter of symbiontsFilters; let i = index">
            <mat-list-item role="listitem"
                           [style]="checkStyle(filter.label + '-' + filter.key)"
                           (click)="onFilterClick(filter.label + '-' + filter.key)" style="cursor: pointer">
              <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
                <div>
                  <h4 matLine class="vertical-center">{{filter.key}}</h4>
                </div>
                <div style="margin-left: auto">
                  <mat-chip-set>
                    <mat-chip style="font-size: 10px">
                      {{filter.doc_count}}
                    </mat-chip>
                  </mat-chip-set>
                </div>
              </div>

            </mat-list-item>
          </ng-container>
        </mat-list>
      </mat-card-actions>
    </mat-card>
    <br>
    <mat-card class="main-card">
      <mat-card-title class="card-title">Projects</mat-card-title>
      <mat-card-actions fxFlexAlign="center" style="width: 100%">
        <mat-list role="list" style="width: 100%">
          <mat-list-item role="listitem" *ngFor="let project of aggregations?.project_name.buckets"
                         style="cursor: pointer" [style]="checkStyle(convertProjectName(project.key))"
                         (click)="onFilterClick(convertProjectName(project.key))">
            <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
              <div>
                <h4 matLine class="vertical-center">{{convertProjectName(project.key)}}</h4>
              </div>
              <div style="margin-left: auto">
                <mat-chip-set>
                  <mat-chip style="font-size: 10px">
                    {{project.doc_count}}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card-actions>
    </mat-card>
    <br>
    <mat-card class="main-card">
      <mat-card-title class="card-title">
        Phylogeny/{{currentClass}}
        <mat-icon *ngIf="phylogenyFilters.length !== 0" (click)="onRefreshClick()" style="cursor: pointer">
          refresh
        </mat-icon>
        <mat-icon *ngIf="phylogenyFilters.length !== 0" (click)="onHistoryClick()" style="cursor: pointer">
          arrow_circle_left
        </mat-icon>
      </mat-card-title>
      <mat-card-actions fxFlexAlign="center" style="width: 100%">
        <mat-list role="list" style="width: 100%">
          <mat-list-item role="listbox" *ngFor="let phylogeny_name of aggregations?.taxonomies[currentClass]?.buckets"
                         style="cursor: pointer" [style]="checkStyle(phylogeny_name.key)"
                         (dblclick)="onFilterClick(phylogeny_name.key)" (click)="changeCurrentClass(phylogeny_name.key)">
            <div fxLayout="row" fxFlexFill fxFlexAlign="center center">
              <div>
                <h4 matLine class="vertical-center">{{phylogeny_name.key}}</h4>
              </div>
              <div style="margin-left: auto">
                <mat-chip-set>
                  <mat-chip style="font-size: 10px">
                    {{phylogeny_name.doc_count}}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card-actions>
    </mat-card>
  </div>


  <div class="item2">
      <h1 style="align-content: center">Data Portal</h1>
    <div class="example-container mat-elevation-z8">

      <div class="example-loading-shade"
           *ngIf="isLoadingResults || isRateLimitReached">
        <mat-spinner *ngIf="isLoadingResults"></mat-spinner>
        <div class="example-rate-limit-reached" *ngIf="isRateLimitReached">
          Something went wrong, please try again!
        </div>
      </div>

      <div class="example-table-container">

        <div class="container2">
          <mat-chip-set>
            <div *ngFor="let item of activeFilters" class="item4">
              <mat-chip  selected (click)="onFilterClick(item)" style="cursor: pointer; padding: 0px; background-color: #e0efea;">
                <div style="display: flex; align-items: center;">
                  <div style="margin-right: 3px">{{displayActiveFilterName(item)}}</div>
                  <mat-icon>close</mat-icon>
                </div>
              </mat-chip>
            </div>
          </mat-chip-set>
        </div>

        <br>

        <button mat-raised-button (click)="exporter.exportTable('csv', {fileName: 'data_portal'})"
                color="accent">
          Download metadata
        </button>

        <mat-form-field class="search_field">
          <mat-label>Search</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="ex. Salmo trutta" #input>
        </mat-form-field>

        <div class="data-table-div">
          <table mat-table [dataSource]="data" class="data-table" matSort matSortActive="currentStatus"
               matSortDisableClear
               matSortDirection="asc" matTableExporter #exporter="matTableExporter" [hiddenColumns]="[4]">
          <!-- Number Column -->
          <ng-container matColumnDef="organism">
            <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Organism</th>
            <td mat-cell *matCellDef="let row">
              <a mat-button [routerLink]="['/data_portal', row._source.organism]">
                {{row._source.organism}}
              </a>
              <mat-chip style="margin-bottom: 5px; background-color: yellow; color: black"
                        *ngIf="checkNagoyaProtocol(row._source)">
                <a mat-button
                   href="https://drive.google.com/file/d/1tkTdo-dI30YFokE2YpwmzP9onhrrEyhD/view?usp=drive_link">
                  Ethics and law</a>
              </mat-chip>
            </td>
          </ng-container>

          <!-- Title Column -->
          <ng-container matColumnDef="commonName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Common Name</th>
            <td mat-cell *matCellDef="let row">{{row._source.commonName}}</td>
          </ng-container>

          <ng-container matColumnDef="commonNameSource">
            <th mat-header-cell *matHeaderCellDef>Common Name Source</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip selected [style]="getCommonNameSourceStyle(row._source.commonNameSource)"
                        *ngIf="row._source.commonNameSource && row._source.commonName">
                {{row._source.commonNameSource}}
              </mat-chip>
            </td>
          </ng-container>

          <!-- State Column -->
          <ng-container matColumnDef="currentStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>Current Status</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip selected [style]="getStyle(row['_source']['currentStatus'])">
                {{row._source.currentStatus}}
              </mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="externalReferences">
            <th mat-header-cell *matHeaderCellDef>External References</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip *ngIf="checkGenomeNotes(row._source)" style="margin-bottom: 5px; margin-top: 5px; background-color: #D8BCAA">
                <a *ngIf="genomelength == 1" mat-button href="{{row._source.genome_notes[0]['url']}}">Genome Note</a>
                <a *ngIf="genomelength > 1" class="genome" target="_blank" (click)="openGenomeNoteDialog(row._source)">
                  Genome Note</a>
              </mat-chip>
              <mat-chip *ngIf="row._source.goat_info && row._source.goat_info.length !== 0"
                        style="margin-left: 5px; margin-bottom: 5px; background-color: #AEBFD3; color: white">
                <a mat-button href="{{row._source.goat_info['url']}}">GoaT Info</a>
              </mat-chip>
              <mat-chip *ngIf="row._source.tolid && checkShowTolQc(row._source)"
                        style="margin-left: 5px; margin-bottom: 5px; background-color: #C0C2C4; color: black">
                <a mat-button href="{{generateTolidLink(row._source)}}">ToL QC</a>
              </mat-chip>
            </td>
          </ng-container>


          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">No data matching the filter</td>
          </tr>
        </table>
        </div>
      </div>



      <mat-paginator [length]="resultsLength"
                     [pageSizeOptions]="[15, 50, 100]"
                     aria-label="Select page" showFirstLastButtons></mat-paginator>
    </div>

  </div>
  <div class="item3">

  </div>
</div>
<br>

